<!DOCTYPE html>
<head>
  <meta charset="utf-8">
  <title>ECharts</title>
</head>
<body>
  <!-- 为ECharts准备一个具备大小（宽高）的Dom -->
  <div id="main" style="height:400px"></div>
  <!-- ECharts单文件引入 -->
  <script src="libs/echarts/dist/echarts.js"></script>
  <script type="text/javascript">
  // 路径配置
  require.config({
    paths: {
      echarts: 'libs/echarts/dist/'
    }
  });


  var nodes = [];
  var links = [];
  var constMaxDepth = 4;
  var constMaxChildren =3;
  var constMinChildren = 1;
  var constMaxRadius = 1000;
  var constMinRadius = 2;
  var mainDom = document.getElementById('main');


  function rangeRandom(min, max) {
    return Math.random() * (max - min) + min;
  }

  function createRandomNode(depth,max,n) {
    var x = mainDom.clientWidth /(max+1) * n;
    if(depth==4){
        console.log(x);
    }

    var y = (mainDom.clientHeight - 20) * depth / (constMaxDepth + 1) + 20;
    // var y = 100;
    var v;
    if (n==1){
      v="left"
    }else{
      v="right"
    }
    var node = {
      name : 'NODE_' + nodes.length+"_"+v,
      value : 1,
      // Custom properties
      id : nodes.length,
      initial : [x, y],
      fixY : true,
      fixX:true,
      symbolSize :10,
      // draggable:false,
      category : depth === constMaxDepth ? 0 : 1
    }
    nodes.push(node);

    return node;
  }


  function forceMockThreeData() {
    var depth = 0;

    var rootNode = createRandomNode(0,1,1);
    rootNode.name = 'ROOT';
    rootNode.category = 2;
    rootNode.symbolSize =15;

    function mock(parentNode, depth) {
      var nChildren = 2;

      for (var i = 0; i < nChildren; i++) {
        var childNode = createRandomNode(depth,4,i+1);
        links.push({
          source : parentNode.id,
          target : childNode.id,
          weight : 1
        });
        for (var i = 0; i < nChildren; i++) {
          var childNode = createRandomNode(depth,4,i+1+2);
          links.push({
            source : parentNode.id,
            target : childNode.id,
            weight : 1
          })
          }
        if (depth > constMaxDepth) {
          return;
        }
      }
    }

    mock(rootNode, 1);
  }


  // 使用
  require(
    [
      'echarts',
      'echarts/chart/force' // 使用柱状图就加载force模块，按需加载
    ],
    function (ec) {
      forceMockThreeData();
      var myChart = ec.init(mainDom);
      var option = {
        title : {
          text: 'Force',
          subtext: 'Force-directed tree',
          x:'right',
          y:'bottom'
        },
        tooltip : {
          trigger: 'item',
          formatter: '{a} : {b}'
        },
        toolbox: {
          show : true,
          feature : {
            restore : {show: true},
            saveAsImage : {show: true}
          }
        },
        legend: {
          x: 'left',
          data:['叶子节点','非叶子节点', '根节点']
        },
        series : [
          {
            type:'force',
            name : "SQL AST Tree",
            categories : [
              {
                name: '叶子节点',
                itemStyle: {
                  normal: {
                    color : '#ff7f50'
                  }
                }
              },
              {
                name: '非叶子节点',
                itemStyle: {
                  normal: {
                    color : '#6f57bc'
                  }
                }
              },
              {
                name: '根节点',
                itemStyle: {
                  normal: {
                    color : '#af0000'
                  }
                }
              }
            ],
            itemStyle: {
              normal: {
                label: {
                  show: false
                },
                nodeStyle : {
                  brushType : 'both',
                  strokeColor : 'rgba(255,215,0,0.6)',
                  lineWidth : 1
                }
              }
            },
            // minRadius : 2,
            // maxRadius : 10,
            gravity:0.1,
            roam:true,
            nodes : nodes,
            links : links
          }
        ]
      };
      // 为echarts对象加载数据
      myChart.setOption(option);
    }
  );
  </script>
</body>
